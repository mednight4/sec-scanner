webpackJsonp([1],{"+Wzp":function(t,e){},"65rq":function(t,e){},"6OI/":function(t,e){},"8xee":function(t,e){},"G/pv":function(t,e){},GRWN:function(t,e){},IVQ6:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("//Fk"),l=a.n(n),r=a("7+uW"),o=a("NYxO"),s=a("zL8q"),i=a.n(s),c=(a("tvR6"),a("mtWM")),u=a.n(c),d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.user?a("el-menu",{staticClass:"el-menu-demo",attrs:{"background-color":"#545c64","active-text-color":"#ffd04b","text-color":"#fff",router:"","default-active":"/"},on:{select:t.handleSelect}},[a("el-menu-item",[t._v("欢迎您，"+t._s(t.user.user_name)+"  "),a("el-link",{staticStyle:{float:"right"},attrs:{type:"danger"},on:{click:t.logout}},[t._v("退出登录")])],1),t._v(" "),a("el-menu-item",{attrs:{index:"/"}},[t._v("首页")]),t._v(" "),a("el-submenu",{attrs:{index:"2"}},[a("template",{slot:"title"},[t._v("资产管理")]),t._v(" "),a("el-menu-item",{attrs:{index:"/assets/add"}},[t._v("资产录入")]),t._v(" "),a("el-menu-item",{attrs:{index:"/assets/list"}},[t._v("资产列表")])],2),t._v(" "),a("el-menu-item",{attrs:{index:"/task/list"}},[t._v("任务计划")]),t._v(" "),a("el-menu-item",{attrs:{index:"/dict/list"}},[t._v("字典")]),t._v(" "),a("el-submenu",{attrs:{index:"5"}},[a("template",{slot:"title"},[t._v("插件管理")]),t._v(" "),a("el-menu-item",{attrs:{index:"/plugins/add"}},[t._v("新增插件")]),t._v(" "),a("el-menu-item",{attrs:{index:"/plugins/list"}},[t._v("插件列表")])],2),t._v(" "),"ROOT"===t.user.type?a("el-submenu",{attrs:{index:"6"}},[a("template",{slot:"title"},[t._v("用户管理")]),t._v(" "),a("el-menu-item",{attrs:{index:"/user/add"}},[t._v("新增用户")]),t._v(" "),a("el-menu-item",{attrs:{index:"/user/list"}},[t._v("用户列表")])],2):t._e(),t._v(" "),a("el-menu-item",{attrs:{index:"/user/pwd"}},[t._v("修改密码")])],1):a("el-menu",{staticClass:"el-menu-demo",attrs:{router:"",mode:"horizontal"}},[a("el-menu-item",[t._v("漏洞扫描系统")]),t._v(" "),a("el-menu-item",{attrs:{disabled:""}},[t._v("未登录")])],1)},staticRenderFns:[]};var p={name:"App",components:{Header:a("VU/8")({name:"Header",created:function(){this.getUser()},data:function(){return{user:this.$store.state.user}},watch:{"$store.state.user":function(){this.user=this.$store.state.user}},methods:{handleSelect:function(){},getUser:function(){var t=this;this.$http.get("/get/user").then(function(e){t.$store.commit("put_user",e.data.data)})},logout:function(){var t=this;this.$confirm("是否确认退出登录","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post("/logout").then(function(e){t.$store.commit("put_user",!1),t.$router.push("/login")})}).catch(function(){})}}},d,!1,function(t){a("qMEO")},"data-v-56b03e6e",null).exports}},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("el-container",[e("el-aside",{attrs:{width:"200px"}},[e("Header")],1),this._v(" "),e("el-container",[e("el-main",[e("router-view")],1)],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(p,f,!1,function(t){a("UtLd")},null,null).exports,h=a("/ocq"),v={name:"Assets",data:function(){return{cdnOptions:[{value:"unknown",label:"排除CDN"},{value:"百度云",label:"百度云"},{value:"腾讯云",label:"腾讯云"},{value:"阿里云",label:"阿里云"}],tableData:[],selected:[],tasks:[],addMode:0,addTaskDialogVisible:!1,loading:!1,plugins:[],form:{ip:"",region:"",port:"",tags:"",cdn:""}}},created:function(){this.loadData(1),this.allPlugin()},methods:{loadData:function(t){var e=this;this.$http.get("/query/ip",{params:{next:t,ip:this.form.ip,region:this.form.region,port:this.form.port,tags:this.form.tags,cdn:this.form.cdn}}).then(function(t){e.tableData=t.data.data})},handleSelectionChange:function(t){this.selected=t},handleEdit:function(){},handleDelete:function(t){var e=this;if(0!==t||0!==this.selected.length){var a=0===t?this.selected.length:1,n=0===t?"/del/ip":"/del/ips";this.$confirm("是否确认删除资产, 该操作无法撤回","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0;for(var l=function(l){var r=0===t?{ip:e.selected[l].ip}:e.form;e.$http.post(n,r).then(function(t){e.$message.success("删除成功"),e.loading=!1,a-1===l&&e.loadData(e.tableData.page)})},r=0;r<a;r++)l(r)}).catch(function(){e.loading=!1})}else this.$message.warning("至少选择一个要删除的资产")},portRoute:function(t,e,a){"80"===e||"8080"===e?window.open("http://"+t+":"+e):"443"===e?window.open("https://"+t):this.$refs.filterTable.toggleRowSelection(a)},handleTransferChange:function(t,e,a){},allPlugin:function(){var t=this;this.$http.get("/all/plugin",{params:{title:""}}).then(function(e){t.plugins=[];for(var a=0;a<e.data.data.length;a++)t.plugins.push({key:e.data.data[a].script,label:e.data.data[a].title,info:e.data.data[a],disabled:!1})})},addTask:function(){var t=this;if(0!==this.tasks.length){var e=this;this.$confirm("是否确认添加任务","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0,e.$http.post("/add/task",{mode:t.addMode,ips:t.selected,region:t.form.region,ip:t.form.ip,port:t.form.port,scripts:t.tasks}).then(function(){e.loading=!1,e.addTaskDialogVisible=!1,e.$message.success("添加任务成功")})}).catch(function(){})}else this.$message.warning("至少选择一个任务脚本")},retryOs:function(t,e){var a=this;this.$confirm("请确认您需要重新扫描, 多次添加扫描任务将会给系统增加负担: "+e.ip,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/retry/os",{ip:e.ip}).then(function(t){a.$message.success("重试任务下发完毕")})}).catch(function(){})},retryScan:function(t,e){var a=this;this.$confirm("请确认您需要重新扫描, 多次添加扫描任务将会给系统增加负担: "+e.ip,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/retry/scan",{ip:e.ip}).then(function(t){a.$message.success("重试任务下发完毕")})}).catch(function(){})}}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.form},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadData(1)}}},[a("el-form-item",{attrs:{label:"IP/域名"}},[a("el-input",{attrs:{placeholder:"IP/域名"},model:{value:t.form.ip,callback:function(e){t.$set(t.form,"ip",e)},expression:"form.ip"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"端口/应用名"}},[a("el-input",{attrs:{placeholder:"端口/应用名"},model:{value:t.form.port,callback:function(e){t.$set(t.form,"port",e)},expression:"form.port"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"标签"}},[a("el-input",{attrs:{placeholder:"标签"},model:{value:t.form.tags,callback:function(e){t.$set(t.form,"tags",e)},expression:"form.tags"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"CDN"}},[a("el-select",{attrs:{"allow-create":"",multiple:!1,filterable:"",title:"支持输入DNS解析搜索",placeholder:"请选择"},model:{value:t.form.cdn,callback:function(e){t.$set(t.form,"cdn",e)},expression:"form.cdn"}},t._l(t.cdnOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"机房"}},[a("el-select",{attrs:{placeholder:"机房"},model:{value:t.form.region,callback:function(e){t.$set(t.form,"region",e)},expression:"form.region"}},[a("el-option",{attrs:{label:"不限",value:""}}),t._v(" "),a("el-option",{attrs:{label:"国内",value:"cn"}}),t._v(" "),a("el-option",{attrs:{label:"香港",value:"hk"}}),t._v(" "),a("el-option",{attrs:{label:"美国",value:"us"}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.loadData(1)}}},[t._v("查询")])],1)],1),t._v(" "),a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.selected.length>0,expression:"selected.length > 0"}]},[a("el-button-group",[a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){t.addTaskDialogVisible=!0,t.addMode=0}}},[a("i",{staticClass:"el-icon-plus"}),t._v(" 对选中条目添加任务")]),t._v(" "),a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(e){t.addTaskDialogVisible=!0,t.addMode=1}}},[a("i",{staticClass:"el-icon-s-order"}),t._v(" 对结果集添加任务")])],1),t._v(" "),a("el-button-group",[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"danger",size:"small"},on:{click:function(e){return t.handleDelete(0)}}},[a("i",{staticClass:"el-icon-close"}),t._v(" 删除选中条目")]),t._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"danger",size:"small"},on:{click:function(e){return t.handleDelete(1)}}},[a("i",{staticClass:"el-icon-error"}),t._v(" 删除查询结果集")])],1)],1)]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"filterTable",attrs:{data:t.tableData.items},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ip",label:"IP",width:"150px"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ports",label:"端口/应用","filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.ports,function(n){return null!==e.row.ports&&void 0!==e.row.ports&&e.row.ports.length>0&&void 0!==n&&void 0!==n.service&&void 0!==n.service.name?a("el-badge",{key:n.port,staticClass:"item",attrs:{value:n.port,type:"open"===n.state?"success":"info"}},[a("el-button",{attrs:{size:"small"},on:{click:function(a){return t.portRoute(e.row.ip,n.port,e.row)}}},[t._v(t._s(n.service.name))])],1):t._e()}),t._v(" "),null===e.row.ports||void 0===e.row.ports?a("el-tag",{attrs:{effect:"plain",type:"warning"}},[t._v("扫描中")]):t._e(),t._v(" "),null!==e.row.ports&&void 0!==e.row.ports&&0===e.row.ports.length?a("el-tag",{attrs:{effect:"plain",type:"info"}},[t._v("无")]):t._e(),t._v(" "),a("el-button",{attrs:{size:"mini",circle:"",icon:"el-icon-refresh",plain:"",type:"warning"},on:{click:function(a){return t.retryScan(e.$index,e.row)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"tags",label:"标签","filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.tags,function(e,n){return a("el-tag",{key:e,attrs:{type:n%2==0?"primary":"success","disable-transitions":""}},[t._v(t._s(e))])})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"dns",label:"DNS分析","filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return null!==e.row.dns&&void 0!==e.row.dns?["unknown"!==e.row.dns.cdn?a("el-alert",{attrs:{type:"warning",title:"CDN - ("+e.row.dns.name+") - "+e.row.dns.cdn,closable:!1}}):t._e(),t._v(" "),t._l(e.row.dns.records,function(e,n){return""!==e.target?a("el-alert",{key:n,attrs:{title:e.target,type:"info",closable:!1}}):t._e()})]:void 0}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"摘要"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.remark,function(e,n){return""!==e?a("el-alert",{key:n,attrs:{title:e,type:0===n?"success":"info",closable:!1}}):t._e()})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"os",label:"猜测系统","filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.os,function(n){return null!==e.row.os&&void 0!==e.row.os&&e.row.os.length>0?a("el-tag",{key:n.name,attrs:{size:"mini",effect:"plain",type:"primary"}},[t._v(t._s(n.name))]):t._e()}),t._v(" "),null===e.row.os||void 0===e.row.os?a("el-tag",{attrs:{size:"mini",effect:"plain",type:"warning"}},[t._v("扫描中")]):t._e(),t._v(" "),null!==e.row.os&&void 0!==e.row.os&&0===e.row.os.length?a("el-tag",{attrs:{size:"mini",effect:"plain",type:"info"}},[t._v("无")]):t._e(),t._v(" "),a("el-button",{attrs:{size:"mini",type:"warning",plain:"",circle:"",icon:"el-icon-refresh"},on:{click:function(a){return t.retryOs(e.$index,e.row)}}})]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"padding-top":"10px"},attrs:{layout:"prev, pager, next","current-page":t.tableData.page,"page-size":t.tableData.page_size,total:t.tableData.total},on:{"current-change":t.loadData,"update:currentPage":function(e){return t.$set(t.tableData,"page",e)},"update:current-page":function(e){return t.$set(t.tableData,"page",e)}}}),t._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:"添加任务",visible:t.addTaskDialogVisible,center:""},on:{"update:visible":function(e){t.addTaskDialogVisible=e}}},[a("div",{staticStyle:{"text-align":"center"}},[a("el-transfer",{staticStyle:{"text-align":"left",display:"inline-block"},attrs:{filterable:"",titles:["未选中插件","已选择插件"],"button-texts":["到左边","到右边"],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:t.plugins},on:{change:t.handleTransferChange},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.option.info.remark,placement:"right",effect:"light"}},[a("span",[t._v(t._s(e.option.label))])])]}}]),model:{value:t.tasks,callback:function(e){t.tasks=e},expression:"tasks"}})],1),t._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"success"},on:{click:t.addTask}},[t._v("确认添加任务")])],1)])],1)},staticRenderFns:[]};var g=a("VU/8")(v,_,!1,function(t){a("GRWN")},"data-v-0339b1d4",null).exports,b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"IP/域名"}},[a("el-input",{attrs:{placeholder:"支持填写域名/IP地址 eg: 10.12.13.24 多个IP地址 eg: 10.12.13.24,10.12.13.25 IP段 eg: 10.12.13.0/24 IP区间 eg: 10.12.13.1-10.12.13.20"},on:{input:t.handleFormat},model:{value:t.form.ip,callback:function(e){t.$set(t.form,"ip",e)},expression:"form.ip"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"机房"}},[a("el-select",{attrs:{placeholder:"请选择所在机房"},model:{value:t.form.region,callback:function(e){t.$set(t.form,"region",e)},expression:"form.region"}},[a("el-option",{attrs:{label:"不限",value:""}}),t._v(" "),a("el-option",{attrs:{label:"国内",value:"cn"}}),t._v(" "),a("el-option",{attrs:{label:"香港",value:"hk"}}),t._v(" "),a("el-option",{attrs:{label:"美国",value:"us"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"标签"}},[a("el-select",{attrs:{filterable:"","allow-create":"",multiple:"",placeholder:"请选择/可创建"},model:{value:t.form.tags,callback:function(e){t.$set(t.form,"tags",e)},expression:"form.tags"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),t.showItem?a("el-form-item",{attrs:{label:"识别子域"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"选中此选项后将会自动识别主域名的子域, 并自动添加端口以及DNS扫描, 仅对输入主域名时有效",placement:"top-start"}},[a("el-switch",{model:{value:t.form.scan_sub_domain,callback:function(e){t.$set(t.form,"scan_sub_domain",e)},expression:"form.scan_sub_domain"}})],1),t._v(" "),a("el-alert",{attrs:{closable:!1,type:t.form.scan_sub_domain?"success":"info",title:"选中此选项后将会自动识别主域名的子域, 并自动生成资产记录添加端口以及DNS扫描, 仅对输入主域名时有效"}})],1):t._e(),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即创建")]),t._v(" "),a("el-button",[t._v("重置")])],1)],1)],1)},staticRenderFns:[]};var y=a("VU/8")({name:"AssetsCreate",data:function(){return{showItem:!1,options:[],loading:!1,form:{ip:"",region:"",scan_sub_domain:!1,tags:[]}}},created:function(){},methods:{onSubmit:function(){var t=this;this.loading=!0,this.$http.post("/add/ip",this.form).then(function(e){t.loading=!1,e.data.state?t.$message.success("添加任务已下发, 您可以继续操作"):t.$message.error(e.data.msg)})},handleChange:function(){var t=this.form.ip.split(".");2===t.length&&""!==t[1]&&"www"!==t[0]||3===t.length&&"www"===t[0]?(this.showItem=!0,this.form.scan_sub_domain=!0):(this.showItem=!1,this.form.scan_sub_domain=!1),-1!==this.form.ip.indexOf(",")&&(this.showItem=!0,this.form.scan_sub_domain=!1)},handleFormat:function(){var t=this.form.ip.split("/");this.form.ip=t.length>2?t[2]:this.form.ip,this.handleChange()}}},b,!1,function(t){a("IVQ6")},"data-v-d0618f54",null).exports,k={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{ref:"filterTable",attrs:{data:t.tableData.items},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"标题"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),t._v(" "),a("el-table-column",{attrs:{prop:"script",label:"脚本"}}),t._v(" "),a("el-table-column",{attrs:{prop:"label",label:"标签"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.label,function(e){return a("el-tag",{key:e},[t._v(t._s(e))])})}}])}),t._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("el-input",{attrs:{size:"mini",placeholder:"输入插件标题搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadData(1)}},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return t.loadData(1)}},slot:"append"})],1)]}},{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.$router.push("/plugins/add/"+e.row.id)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"padding-top":"10px"},attrs:{layout:"prev, pager, next","current-page":t.tableData.page,"page-size":t.tableData.page_size,total:t.tableData.total},on:{"current-change":t.loadData,"update:currentPage":function(e){return t.$set(t.tableData,"page",e)},"update:current-page":function(e){return t.$set(t.tableData,"page",e)}}})],1)},staticRenderFns:[]};var w=a("VU/8")({name:"Plugins.vue",data:function(){return{tableData:[],title:""}},created:function(){this.loadData(1)},methods:{loadData:function(t){var e=this;this.$http.get("/query/plugin",{params:{next:t,title:this.title}}).then(function(t){e.tableData=t.data.data})},handleSelectionChange:function(){},handleEdit:function(t,e){},handleDelete:function(t,e){var a=this;this.$confirm("是否确认删除插件(文件不会被删除): "+e.title,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/del/plugin",{id:e.id}).then(function(e){a.$message.success("删除成功"),a.tableData.items.splice(t,1)})}).catch(function(){})}}},k,!1,function(t){a("x52J")},"data-v-4012b170",null).exports,$={name:"PluginCreate",data:function(){return{options:[{value:"紧急",name:"emergency"},{value:"高危",name:"danger"},{value:"中危",name:"warning"},{value:"低危",name:"info"}],form:{title:"",remark:"",script:"",label:[]},id:this.$route.params.id}},created:function(){this.viewPlugin(this.id)},methods:{viewPlugin:function(t){if(null!==t&&void 0!==t){var e=this;this.$http.post("/view/plugin",{id:t}).then(function(t){e.form=t.data.data})}},onSubmit:function(){null!==this.id&&void 0!==this.id?this.form.id=this.id:this.form.id=void 0;var t=this;this.$http.post("/add/plugin",this.form).then(function(e){t.$message.success("操作成功"),t.$router.push("/plugins/list")})}}},x={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"插件名",prop:"title"}},[a("el-input",{attrs:{placeholder:""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"插件代码",prop:"script"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:20,maxRows:140}},model:{value:t.form.script,callback:function(e){t.$set(t.form,"script",e)},expression:"form.script"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"标签"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.form.label,callback:function(e){t.$set(t.form,"label",e)},expression:"form.label"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即"+t._s(void 0!==t.id?"修改":"创建"))]),t._v(" "),a("el-button",{on:{click:function(e){t.id=void 0}}},[t._v("重置")])],1)],1)],1)},staticRenderFns:[]};var D=a("VU/8")($,x,!1,function(t){a("+Wzp")},"data-v-00700546",null).exports,N={name:"Dashboard",data:function(){return{addHostDialogVisible:!1,trigger:null,user:{},data:{asset:0,running:0,error:0,handle:0},form:{ip:"localhost",name:"node",code:"",mq:"",rds:"",count:1,version:"1.3.1"},hosts:[]}},mounted:function(){this.breathInfo()},created:function(){this.getUser(),this.countAsset()},destroyed:function(){window.clearInterval(this.trigger)},methods:{getUser:function(){var t=this;this.$http.get("/get/user").then(function(e){t.user=e.data.data,t.getEnv()})},countAsset:function(){var t=this;this.$http.get("/count/asset").then(function(e){t.data=e.data.data})},breathInfo:function(){var t=this;t.$http.get("/list/breath").then(function(e){t.hosts=e.data.data}),this.trigger=setInterval(function(){t.$http.get("/list/breath").then(function(e){t.hosts=e.data.data})},3e4)},getEnv:function(){var t=this;if("ROOT"!==this.user.type)return!1;this.$http.get("/get/env").then(function(e){t.form.mq=e.data.data.mq,t.form.rds=e.data.data.redis,t.form.version=e.data.data.node_version})},randomPwd:function(t){for(var e=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"],a="",n=e.length,l=0;l<t;l++){a+=e[Math.floor(Math.random()*n)]}return a},handleChange:function(){for(var t="",e="",a=0;a<this.form.count;a++)t=this.form.name+"_"+this.form.ip+"_"+this.randomPwd(12),e+="docker run -d --restart=always --env HEART_RATE=30 --env REDIS_ENV="+this.form.rds+" --name "+t+" --hostname "+t+" ccr.ccs.tencentyun.com/whitney/xn-secnode:"+this.form.version+"\n";this.form.code=e}}},S={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:8}},[a("el-card",[t._v("\n          IP总数\n          "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.push("/assets/list")}}},[t._v(t._s(t.data.asset))])],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-card",[t._v("\n          执行中任务\n          "),a("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.$router.push("/task/list/1")}}},[t._v(t._s(t.data.running))])],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-card",[t._v("\n          已发现问题\n          "),a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.$router.push("/task/list/2")}}},[t._v(t._s(t.data.error))])],1)],1)],1),t._v(" "),"ROOT"===t.user.type?a("div",[a("br"),t._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"warning"},on:{click:function(e){t.addHostDialogVisible=!0}}},[a("i",{staticClass:"el-icon-circle-plus-outline"}),t._v(" 添加任务执行节点")])],1),t._v(" "),a("br")]):t._e(),t._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"执行节点监控"}},[a("el-row",{attrs:{gutter:12}},t._l(t.hosts,function(e){return a("el-col",{key:e.server,attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-alert",{attrs:{shadow:"hover",closable:!1,type:!e.active&&(new Date-new Date(parseInt(e.timespan)))/1e3/60<3?"warning":(new Date-new Date(parseInt(e.timespan)))/1e3/60>3?"error":"success",title:e.server,"show-icon":""}},[a("template",{slot:"default"},[a("span",[t._v(t._s((new Date-new Date(parseInt(e.timespan)))/1e3/60>3?"无响应":!1!==e.info?e.info.state+": "+e.info.script_name+"  目标: "+e.info.target+" | 时间: "+e.info.modify_time:"空闲中"))])])],2)],1)],1)}),1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"生成部署代码",visible:t.addHostDialogVisible,center:""},on:{"update:visible":function(e){t.addHostDialogVisible=e}}},[a("el-form",{attrs:{"label-width":"80px",model:t.form}},[a("el-form-item",{attrs:{label:"IP"}},[a("el-input",{on:{input:t.handleChange},model:{value:t.form.ip,callback:function(e){t.$set(t.form,"ip",e)},expression:"form.ip"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"主机名"}},[a("el-input",{on:{input:t.handleChange},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"节点版本"}},[a("el-input",{on:{input:t.handleChange},model:{value:t.form.version,callback:function(e){t.$set(t.form,"version",e)},expression:"form.version"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"节点版本"}},[a("el-input-number",{on:{input:t.handleChange},model:{value:t.form.count,callback:function(e){t.$set(t.form,"count",e)},expression:"form.count"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"生成代码"}},[a("el-input",{attrs:{type:"textarea",readonly:"",autosize:{minRows:5,maxRows:140}},model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1)],1)],1)],1)},staticRenderFns:[]};var T=a("VU/8")(N,S,!1,function(t){a("6OI/")},"data-v-42d254e9",null).exports,R=a("mvHQ"),C=a.n(R),E={name:"Dict",data:function(){return{tableData:[],form:{dict_key:"",dict_value:"",remark:""},keyPre:"SEC_",remark:"",type:"text",types:[{value:"text",label:"text"},{value:"json",label:"json"},{value:"separate",label:"separate"}],separate:"",dialogAddDictVisible:!1,isModify:!1}},created:function(){this.loadData(1)},methods:{onSearch:function(){},handleEdit:function(t,e){this.dialogAddDictVisible=!0,this.isModify=!0;var a=JSON.parse(e.dict_value);this.type=a.type,this.separate=a.separate,this.form.remark=e.remark,this.form.dict_key=e.dict_key.replace(this.keyPre,""),this.form.dict_value=a.info},handleDelete:function(t,e){var a=this;this.$confirm("是否确认删除字典: "+e.remark,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/del/dict",{dict_key:e.dict_key}).then(function(e){a.$message.success("删除成功"),a.tableData.items.splice(t,1)})}).catch(function(){})},onSubmit:function(){var t=this,e=this;this.form.dict_value=C()({type:this.type,separate:this.separate,info:this.form.dict_value}),void 0!==this.form.dict_key&&null!==this.form.dict_key?(this.form.dict_key.startsWith(this.keyPre)||(this.form.dict_key=this.keyPre+this.form.dict_key),this.$http.post("/add/dict",this.form).then(function(a){t.$refs.form.resetFields(),"error"!==a.data.code?(t.isModify=!1,e.type=e.types[0].value,e.$message.success("添加成功"),e.dialogAddDictVisible=!1,e.loadData(1)):e.$message.error(a.data.msg)})):this.$message.error("键为空")},loadData:function(t){var e=this;this.$http.get("/query/dict",{params:{next:t,remark:this.remark}}).then(function(t){e.tableData=t.data.data})}}},z={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData.items}},[a("el-table-column",{attrs:{label:"键",prop:"dict_key"}}),t._v(" "),a("el-table-column",{attrs:{label:"值",prop:"dict_value","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(JSON.parse(e.row.dict_value).info)+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"备注",prop:"remark"}}),t._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("el-input",{attrs:{size:"mini",placeholder:"输入备注关键字搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadData(1)}},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}},[a("el-button",{attrs:{slot:"prepend",size:"mini"},on:{click:function(e){t.isModify=!1,t.dialogAddDictVisible=!0}},slot:"prepend"},[t._v("+新增字典")]),t._v(" "),a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return t.loadData(1)}},slot:"append"})],1)]}},{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"padding-top":"10px"},attrs:{layout:"prev, pager, next","current-page":t.tableData.page,"page-size":t.tableData.page_size,total:t.tableData.total},on:{"current-change":t.loadData,"update:currentPage":function(e){return t.$set(t.tableData,"page",e)},"update:current-page":function(e){return t.$set(t.tableData,"page",e)}}}),t._v(" "),a("el-dialog",{attrs:{title:t.isModify?"修改字典":"添加字典",visible:t.dialogAddDictVisible,center:""},on:{"update:visible":function(e){t.dialogAddDictVisible=e}}},[a("el-alert",{attrs:{closable:!1}},[t._v('文档最终会生成类似如下格式: { "type":"文档类型","separate":"分隔符","info":"值" }')]),a("br"),t._v(" "),a("el-form",{ref:"form",attrs:{model:t.form}},[a("el-form-item",{attrs:{label:"文档类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"文档类型"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.types,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),a("el-input",{staticStyle:{width:"60%"},attrs:{disabled:"separate"!==t.type,placeholder:"分隔符号"},model:{value:t.separate,callback:function(e){t.separate=e},expression:"separate"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"键",prop:"key"}},[a("el-input",{attrs:{placeholder:""},model:{value:t.form.dict_key,callback:function(e){t.$set(t.form,"dict_key",e)},expression:"form.dict_key"}},[a("template",{slot:"prepend"},[t._v(t._s(t.keyPre))])],2)],1),t._v(" "),a("el-form-item",{attrs:{label:"值",prop:"dict_value"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:1e3}},model:{value:t.form.dict_value,callback:function(e){t.$set(t.form,"dict_value",e)},expression:"form.dict_value"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{placeholder:""},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.isModify?"立即修改":"立即创建"))])],1)],1)],1)],1)},staticRenderFns:[]};var A=a("VU/8")(E,z,!1,function(t){a("bDpz")},"data-v-4e8ef676",null).exports,I={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.form},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadData(1)}}},[a("el-form-item",{attrs:{label:"目标"}},[a("el-input",{attrs:{placeholder:"目标"},model:{value:t.form.target,callback:function(e){t.$set(t.form,"target",e)},expression:"form.target"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"执行节点"}},[a("el-input",{attrs:{placeholder:"执行节点"},model:{value:t.form.handle_node,callback:function(e){t.$set(t.form,"handle_node",e)},expression:"form.handle_node"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"运行状态"}},[a("el-select",{attrs:{placeholder:"运行状态"},model:{value:t.form.state,callback:function(e){t.$set(t.form,"state",e)},expression:"form.state"}},[a("el-option",{attrs:{label:"不限",value:""}}),t._v(" "),a("el-option",{attrs:{label:"待下发",value:"READY"}}),t._v(" "),a("el-option",{attrs:{label:"已就绪",value:"RUN_ABLE"}}),t._v(" "),a("el-option",{attrs:{label:"运行中",value:"RUNNING"}}),t._v(" "),a("el-option",{attrs:{label:"执行完毕",value:"FINISH"}}),t._v(" "),a("el-option",{attrs:{label:"执行失败",value:"FAIL"}}),t._v(" "),a("el-option",{attrs:{label:"停止",value:"STOP"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"执行结果"}},[a("el-select",{attrs:{placeholder:"执行结果"},model:{value:t.form.result_state,callback:function(e){t.$set(t.form,"result_state",e)},expression:"form.result_state"}},[a("el-option",{attrs:{label:"不限",value:""}}),t._v(" "),a("el-option",{attrs:{label:"未发现异常",value:"0"}}),t._v(" "),a("el-option",{attrs:{label:"发现异常",value:"1"}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.loadData(1)}}},[t._v("查询")])],1)],1),t._v(" "),a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.selected.length>0,expression:"selected.length > 0"}]},[a("el-button-group",[a("el-button",{attrs:{type:"info",size:"small"},on:{click:t.handleCancelList}},[a("i",{staticClass:"el-icon-close"}),t._v(" 取消选中任务")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:t.handleCancelResult}},[a("i",{staticClass:"el-icon-error"}),t._v(" 取消查询结果集")])],1),t._v(" "),a("el-button",{attrs:{type:"warning",size:"small"},on:{click:t.handleRetryList}},[a("i",{staticClass:"el-icon-s-order"}),t._v(" 重新提交选中任务")]),t._v(" "),a("el-button-group",[a("el-button",{attrs:{type:"danger",size:"small"},on:{click:t.handleDelTask}},[a("i",{staticClass:"el-icon-close"}),t._v(" 删除选中任务")]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:t.handleDelTasks}},[a("i",{staticClass:"el-icon-error"}),t._v(" 删除查询结果集")])],1)],1)]),t._v(" "),a("el-table",{ref:"filterTable",attrs:{data:t.tableData.items},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{prop:"target",label:"目标"}}),t._v(" "),a("el-table-column",{attrs:{prop:"handle_node",label:"执行节点"},scopedSlots:t._u([{key:"default",fn:function(e){return[null!=e.row.handle_node&&void 0!==e.row.handle_node?a("el-tag",{attrs:{size:"small",type:"default"}},[t._v(t._s(e.row.handle_node))]):a("el-tag",{attrs:{size:"small",type:"info"}},[t._v("未分配")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"state",label:"运行状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["READY"===e.row.state?a("el-tag",{attrs:{size:"small",type:"default"}},[t._v("待下发")]):t._e(),t._v(" "),"RUN_ABLE"===e.row.state?a("el-tag",{attrs:{size:"small",type:"warning"}},[t._v("已就绪")]):t._e(),t._v(" "),"RUNNING"===e.row.state?a("el-tag",{attrs:{size:"small",type:"primary"}},[t._v("运行中")]):t._e(),t._v(" "),"FINISH"===e.row.state?a("el-tag",{attrs:{size:"small",type:"success"}},[t._v("执行完毕")]):t._e(),t._v(" "),"FAIL"===e.row.state?a("el-tag",{attrs:{size:"small",type:"danger"}},[t._v("执行失败")]):t._e(),t._v(" "),"CANCEL"===e.row.state?a("el-tag",{attrs:{size:"small",type:"info"}},[t._v("停止")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"cron",label:"频次"},scopedSlots:t._u([{key:"default",fn:function(e){return["ONCE"===e.row.cron?a("el-tag",{attrs:{size:"small",type:"default"}},[t._v("单次")]):t._e(),t._v(" "),"DAILY"===e.row.cron?a("el-tag",{attrs:{size:"small",type:"warning"}},[t._v("每日")]):t._e(),t._v(" "),"WEEKLY"===e.row.cron?a("el-tag",{attrs:{size:"small",type:"success"}},[t._v("每周")]):t._e(),t._v(" "),"MONTHLY"===e.row.cron?a("el-tag",{attrs:{size:"small",type:"info"}},[t._v("每月")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"script",label:"执行脚本"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{href:e.row.script,target:"_blank",type:"info"}},[t._v(t._s(e.row.script_name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"result",label:"执行结果"},scopedSlots:t._u([{key:"default",fn:function(e){return["READY"===e.row.state||"RUN_ABLE"===e.row.state||"RUNNING"===e.row.state?a("el-tag",{attrs:{size:"small",type:"info",effect:"plain"}},[t._v("待返回")]):a("el-alert",{attrs:{closable:!1,type:e.row.result_state||"FAIL"===e.row.state||"READY"===e.row.state||"RUN_ABLE"===e.row.state?"error":"success",description:null===e.row.result||void 0===e.row.result||""===e.row.result?"未发现异常":e.row.result,"show-icon":""}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return["UNTREATED"===e.row.handle_state&&!0===e.row.result_state?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleTreated(e.$index,e.row)}}},[t._v("标记为解决")]):t._e(),t._v(" "),"FAIL"===e.row.state||"CANCEL"===e.row.state||"FINISH"===e.row.state?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.handleRetry(e.$index,e.row)}}},[t._v(t._s("FINISH"===e.row.state?"重发":"重试"))]):t._e(),t._v(" "),"READY"===e.row.state||"RUN_ABLE"===e.row.state||"RUNNING"===e.row.state?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return t.handleCancel(e.$index,e.row)}}},[t._v("取消任务")]):t._e()]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"padding-top":"10px"},attrs:{layout:"prev, pager, next","current-page":t.tableData.page,"page-size":t.tableData.page_size,total:t.tableData.total},on:{"current-change":t.loadData,"update:currentPage":function(e){return t.$set(t.tableData,"page",e)},"update:current-page":function(e){return t.$set(t.tableData,"page",e)}}})],1)},staticRenderFns:[]};var O=a("VU/8")({name:"Tasks.vue",data:function(){return{selected:[],tableData:[],form:{target:"",state:"1"===this.$route.params.type?"RUNNING":"",result_state:"2"===this.$route.params.type?"1":""}}},created:function(){this.loadData(1)},methods:{loadData:function(t){var e=this;this.$http.get("/query/task",{params:{next:t,target:this.form.target,handle_node:this.form.handle_node,state:this.form.state,result_state:this.form.result_state}}).then(function(t){e.tableData=t.data.data})},handleSelectionChange:function(t){this.selected=t},handleEdit:function(t,e){},handleDelTask:function(){var t=this;this.$confirm('是否确认批量删除任务(仅可删除 "已完成", "失败", "停止" 状态的任务)',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var e=function(e){"FAIL"!==t.selected[e].state&&"FINISH"!==t.selected[e].state&&"STOP"!==t.selected[e].state||t.$http.post("/del/task",{id:t.selected[e].id}).then(function(a){t.$message.success("任务["+t.selected[e].task_name+"]删除完毕"),e===t.selected.length-1&&t.loadData(t.tableData.page)})},a=0;a<t.selected.length;a++)e(a)}).catch(function(){})},handleDelTasks:function(){var t=this;this.$confirm('是否确认按查询结果集删除任务(仅可删除 "已完成", "失败", "停止" 状态的任务)',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.post("/del/tasks",t.form).then(function(e){t.$message.success("任务删除完毕"),t.loadData(t.tableData.page)})}).catch(function(){})},handleRetryList:function(){var t=this;this.$confirm("是否确认批量重新提交任务","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var e=function(e){"FAIL"!==t.selected[e].state&&"CANCEL"!==t.selected[e].state&&"FINISH"!==t.selected[e].state||t.$http.post("/retry/task",{id:t.selected[e].id}).then(function(a){t.$message.success("重试任务["+t.selected[e].task_name+"]下发完毕"),e===t.selected.length-1&&t.loadData(t.tableData.page)})},a=0;a<t.selected.length;a++)e(a)}).catch(function(){})},handleRetry:function(t,e){var a=this;this.$confirm("是否确认重试任务: "+e.target,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/retry/task",{id:e.id}).then(function(e){a.$message.success("重试任务下发完毕"),a.tableData.items[t].state="RUN_ABLE"})}).catch(function(){})},handleCancelList:function(){var t=this;this.$confirm("是否确认批量取消任务","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var e=function(e){if("READY"===t.selected[e].state||"RUN_ABLE"===t.selected[e].state||"RUNNING"===t.selected[e].state){var a=t.selected[e];t.$http.post("/cancel/task",{task_name:t.selected[e].task_name,handle_node:t.selected[e].handle_node,state:t.selected[e].state}).then(function(n){"RUNNING"===a.state?t.$message.success("取消任务下发完毕, 将通知执行节点取消任务."):t.$message.success("取消任务成功."),t.selected.length-1===e&&t.loadData(t.tableData.page)})}},a=0;a<t.selected.length;a++)e(a)}).catch(function(){})},handleCancelResult:function(){var t=this;this.$confirm("是否取消查询结果集中的所有任务","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$message.warning("取消任务下发中, 任务太多会时间较长, 您可以进行其他操作."),t.$http.post("/cancel/tasks",t.form).then(function(){t.$message.success("取消成功, 运行中的任务将会逐步通知节点取消."),t.loadData(t.tableData.page)})}).catch(function(){})},handleCancel:function(t,e){var a=this;this.$confirm("是否取消任务: "+e.target,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/cancel/task",{task_name:e.task_name,handle_node:e.handle_node,state:e.state}).then(function(n){"RUNNING"===e.state?a.$message.success("取消任务下发完毕, 将通知执行节点取消任务."):(a.$message.success("取消任务成功."),a.tableData.items.splice(t,1))})}).catch(function(){})},handleTreated:function(t,e){var a=this;this.$confirm("是否确认已经解决该问题: "+e.target,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/treated/task",{id:e.id}).then(function(e){a.$message.success("操作成功"),a.tableData.items[t].handle_state="TREATED"})}).catch(function(){})}}},I,!1,function(t){a("8xee")},"data-v-7f78d3de",null).exports,B={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.form},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadData(1)}}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{placeholder:"用户名"},model:{value:t.form.user_name,callback:function(e){t.$set(t.form,"user_name",e)},expression:"form.user_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"用户状态"}},[a("el-select",{attrs:{placeholder:"用户状态"},model:{value:t.form.state,callback:function(e){t.$set(t.form,"state",e)},expression:"form.state"}},[a("el-option",{attrs:{label:"不限",value:""}}),t._v(" "),a("el-option",{attrs:{label:"正常",value:"NORMAL"}}),t._v(" "),a("el-option",{attrs:{label:"封禁",value:"BANED"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"用户类型"}},[a("el-select",{attrs:{placeholder:"用户类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[a("el-option",{attrs:{label:"不限",value:""}}),t._v(" "),a("el-option",{attrs:{label:"普通用户",value:"NORMAL"}}),t._v(" "),a("el-option",{attrs:{label:"管理员",value:"ROOT"}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.loadData(1)}}},[t._v("查询")])],1)],1),t._v(" "),a("el-table",{ref:"filterTable",attrs:{data:t.tableData.items},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"user_name",label:"用户名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"用户类型","filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return["ROOT"===e.row.type?a("el-tag",{attrs:{effect:"plain",type:"warning"}},[t._v("管理员")]):t._e(),t._v(" "),"NORMAL"===e.row.type?a("el-tag",{attrs:{effect:"plain",type:"info"}},[t._v("普通用户")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"state",label:"用户状态","filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return["BANED"===e.row.state?a("el-tag",{attrs:{effect:"plain",type:"danger"}},[t._v("封禁")]):t._e(),t._v(" "),"NORMAL"===e.row.state?a("el-tag",{attrs:{effect:"plain",type:"success"}},[t._v("正常")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")]),t._v(" "),"NORMAL"===e.row.state?a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.handleState(e.$index,e.row,"BANED")}}},[t._v("封禁")]):t._e(),t._v(" "),"BANED"===e.row.state?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return t.handleState(e.$index,e.row,"NORMAL")}}},[t._v("解封")]):t._e()]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"padding-top":"10px"},attrs:{layout:"prev, pager, next","current-page":t.tableData.page,"page-size":t.tableData.page_size,total:t.tableData.total},on:{"current-change":t.loadData,"update:currentPage":function(e){return t.$set(t.tableData,"page",e)},"update:current-page":function(e){return t.$set(t.tableData,"page",e)}}})],1)},staticRenderFns:[]};var U=a("VU/8")({name:"Users",data:function(){return{tableData:[],form:{user_name:"",state:"",type:""}}},created:function(){this.loadData(1)},methods:{loadData:function(t){var e=this;this.$http.get("/query/user",{params:{next:t,user_name:this.form.user_name,state:this.form.state,type:this.form.type}}).then(function(t){e.tableData=t.data.data})},handleSelectionChange:function(t){this.selected=t},handleEdit:function(){},handleDelete:function(t,e){var a=this;this.$confirm("是否确认删除用户: "+e.user_name,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.post("/del/user",{user_name:e.user_name}).then(function(e){a.$message.success("删除成功"),a.tableData.items.splice(t,1)})}).catch(function(){})},handleState:function(t,e,a){var n=this;this.$confirm("是否确认"+("BANED"===a?' "封禁" ':' "解封" ')+"用户: "+e.user_name,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n.$http.post("/modify/state",{user_name:e.user_name,state:a}).then(function(e){n.$message.success("操作成功"),n.tableData.items[t].state=a})}).catch(function(){})}}},B,!1,function(t){a("lfK/")},"data-v-736ad366",null).exports,L={name:"UserCreate",data:function(){return{options:[],form:{user_name:"",pass_word:"",type:"NORMAL"}}},created:function(){},methods:{onSubmit:function(){var t=this,e=this;this.form.pass_word=this.randomPwd(18),this.$http.post("/add/user",this.form).then(function(a){a.data.state?t.$alert("初始密码为: ["+e.form.pass_word+"] 请牢记, 及时修改","用户创建成功",{confirmButtonText:"确定",callback:function(){}}):e.$message.error(a.data.msg)})},randomPwd:function(t){for(var e=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_","-","$","%","&","@","+","!"],a="",n=e.length,l=0;l<t;l++){a+=e[Math.floor(Math.random()*n)]}return a}}},P={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{placeholder:"请填写用户名"},model:{value:t.form.user_name,callback:function(e){t.$set(t.form,"user_name",e)},expression:"form.user_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"用户类型"}},[a("el-select",{attrs:{placeholder:"请选择用户类型"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[a("el-option",{attrs:{label:"普通用户",value:"NORMAL"}}),t._v(" "),a("el-option",{attrs:{label:"管理员",value:"ROOT"}})],1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即创建")])],1)],1)],1)},staticRenderFns:[]};var V=a("VU/8")(L,P,!1,function(t){a("G/pv")},"data-v-0d5228ec",null).exports,F={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"新密码"}},[a("el-input",{attrs:{"show-password":"",placeholder:"请填写您的新密码"},model:{value:t.form.new_pwd,callback:function(e){t.$set(t.form,"new_pwd",e)},expression:"form.new_pwd"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即修改")])],1)],1)],1)},staticRenderFns:[]};var M=a("VU/8")({name:"UserPwd",data:function(){return{options:[],form:{new_pwd:""}}},created:function(){},methods:{onSubmit:function(){var t=this;this.$http.post("/modify/pwd",this.form).then(function(e){e.data.state?t.$message.success("修改成功, 下次登录请使用新密码"):t.$message.error(e.data.msg)})}}},F,!1,function(t){a("iyCT")},"data-v-77fb16c6",null).exports,H={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSubmit(e)}}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{placeholder:"请填写您的用户名"},model:{value:t.form.user_name,callback:function(e){t.$set(t.form,"user_name",e)},expression:"form.user_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"密码"}},[a("el-input",{attrs:{"show-password":"",placeholder:"请填写您的密码"},model:{value:t.form.pass_word,callback:function(e){t.$set(t.form,"pass_word",e)},expression:"form.pass_word"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("登录")])],1)],1)],1)},staticRenderFns:[]};var q=a("VU/8")({name:"Login",data:function(){return{form:{user_name:"",pass_word:""}}},created:function(){this.getUser()},methods:{getUser:function(){var t=this;this.$http.get("/get/user").then(function(e){e.data.state&&(t.$store.commit("put_user",e.data.data),t.$router.push("/").catch(function(){}))})},onSubmit:function(){var t=this;this.$http.post("/login",this.form).then(function(e){e.data.state?(t.$message.success("登录成功"),t.$store.commit("put_user",e.data.data),t.getUser(),t.$router.push("/").catch(function(){})):t.$message.error(e.data.msg)})}}},H,!1,function(t){a("65rq")},"data-v-1692cd9c",null).exports;r.default.use(h.a);var G=new h.a({routes:[{path:"/",name:"Dashboard",component:T},{path:"/assets/list",name:"Assets",component:g},{path:"/assets/add",name:"AssetsCreate",component:y},{path:"/plugins/list",name:"Plugins",component:w},{path:"/task/list/:type?",name:"Tasks",component:O},{path:"/plugins/add/:id?",name:"PluginCreate",component:D},{path:"/dict/list",name:"Dict",component:A},{path:"/user/list",name:"Users",component:U},{path:"/user/add",name:"UserCreate",component:V},{path:"/user/pwd",name:"UserPwd",component:M},{path:"/login",name:"Login",component:q}]});r.default.use(i.a),r.default.use(o.a),r.default.config.productionTip=!1,u.a.defaults.baseURL="/api",u.a.interceptors.response.use(function(t){return t},function(t){return 401===t.response.status&&G.push({path:"/login"}),l.a.reject(t)}),r.default.prototype.$http=u.a;var Y=new o.a.Store({state:{user:{}},mutations:{put_user:function(t,e){t.user=e}}});new r.default({el:"#app",router:G,store:Y,components:{App:m},template:"<App/>"})},UtLd:function(t,e){},bDpz:function(t,e){},iyCT:function(t,e){},"lfK/":function(t,e){},qMEO:function(t,e){},tvR6:function(t,e){},x52J:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.d25d6afeb328bc0ba62a.js.map